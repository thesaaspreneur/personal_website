---
// Buttondown-powered subscribe form â€” no third-party branding
---

<form id="subscribe-form" class="max-w-sm mx-auto">
  <div class="flex items-center border border-stone-200 dark:border-stone-700 rounded-lg overflow-hidden transition-colors focus-within:border-accent dark:focus-within:border-accent-dark">
    <input
      type="email"
      name="email"
      placeholder="your@email.com"
      required
      autocomplete="email"
      class="flex-1 bg-transparent px-4 py-2.5 text-sm font-mono text-stone-800 dark:text-stone-200 placeholder:text-stone-400 dark:placeholder:text-stone-600 focus:outline-none"
    />
    <button
      type="submit"
      class="px-4 py-2.5 text-stone-400 dark:text-stone-500 hover:text-accent dark:hover:text-accent-dark transition-colors !bg-none"
      aria-label="Subscribe"
    >
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M3 9h12M10 4l5 5-5 5" />
      </svg>
    </button>
  </div>
  <p id="subscribe-msg" class="text-xs font-mono text-center mt-2 h-5"></p>
</form>

<script>
  const form = document.getElementById('subscribe-form') as HTMLFormElement;
  const msg = document.getElementById('subscribe-msg')!;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const input = form.querySelector('input[name="email"]') as HTMLInputElement;
    const email = input.value.trim();
    if (!email) return;

    const btn = form.querySelector('button')!;
    btn.disabled = true;
    msg.textContent = '';

    try {
      const res = await fetch('/api/subscribe', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email }),
      });

      if (res.ok) {
        msg.textContent = "You're in.";
        msg.classList.add('text-accent', 'dark:text-accent-dark');
        msg.classList.remove('text-red-500');
        input.value = '';
      } else {
        const data = await res.json();
        msg.textContent = data.error || 'Something went wrong.';
        msg.classList.add('text-red-500');
        msg.classList.remove('text-accent', 'dark:text-accent-dark');
      }
    } catch {
      msg.textContent = 'Something went wrong.';
      msg.classList.add('text-red-500');
      msg.classList.remove('text-accent', 'dark:text-accent-dark');
    } finally {
      btn.disabled = false;
    }
  });
</script>
