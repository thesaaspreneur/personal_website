---
// Pagefind search â€” loaded from the built index
---

<button
  id="search-button"
  type="button"
  aria-label="Search"
  class="p-2 rounded-md text-stone-400 dark:text-stone-500 hover:text-stone-700 dark:hover:text-stone-300 hover:bg-stone-100 dark:hover:bg-stone-800 transition-colors"
>
  <svg
    class="w-[18px] h-[18px]"
    fill="none"
    viewBox="0 0 24 24"
    stroke-width="1.5"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"
    />
  </svg>
</button>

<!-- Search modal -->
<div
  id="search-modal"
  class="fixed inset-0 z-50 hidden"
  role="dialog"
  aria-modal="true"
>
  <div class="fixed inset-0 bg-black/40 backdrop-blur-sm" id="search-backdrop"></div>
  <div class="fixed inset-x-4 top-[10%] sm:inset-x-auto sm:left-1/2 sm:-translate-x-1/2 sm:w-full sm:max-w-lg z-10">
    <div class="bg-surface dark:bg-surface-dark rounded-xl shadow-2xl border border-stone-200 dark:border-stone-700 overflow-hidden">
      <div id="search-container" class="p-4"></div>
    </div>
  </div>
</div>

<script>
  let pagefindLoaded = false;

  function openSearch() {
    const modal = document.getElementById('search-modal');
    modal?.classList.remove('hidden');
    document.body.style.overflow = 'hidden';

    if (!pagefindLoaded) {
      pagefindLoaded = true;
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = '/pagefind/pagefind-ui.css';
      document.head.appendChild(link);

      const script = document.createElement('script');
      script.src = '/pagefind/pagefind-ui.js';
      script.onload = () => {
        // @ts-ignore
        new PagefindUI({
          element: '#search-container',
          showSubResults: true,
          showImages: false,
        });
        setTimeout(() => {
          const input = document.querySelector<HTMLInputElement>('#search-container input');
          input?.focus();
        }, 100);
      };
      document.head.appendChild(script);
    } else {
      setTimeout(() => {
        const input = document.querySelector<HTMLInputElement>('#search-container input');
        input?.focus();
      }, 50);
    }
  }

  function closeSearch() {
    const modal = document.getElementById('search-modal');
    modal?.classList.add('hidden');
    document.body.style.overflow = '';
  }

  document.getElementById('search-button')?.addEventListener('click', openSearch);
  document.getElementById('search-backdrop')?.addEventListener('click', closeSearch);
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeSearch();
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      openSearch();
    }
  });
</script>
